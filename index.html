<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Div.1 League Table (FM-style)</title>

  <!-- Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0f18;
      --panel:#111827;
      --panel2:#0f172a;
      --line:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.88);
      --muted:rgba(255,255,255,.60);

      --gold:#facc15;   /* å„ªå‹ï¼šé»„è‰² */
      --orange:#fb923c; /* å…¥ã‚Œæ›¿ãˆæˆ¦ï¼šã‚ªãƒ¬ãƒ³ã‚¸ */
      --red:#ef4444;    /* é™æ ¼ï¼šèµ¤ */

      --btn:#1f2937;
      --btn2:#0b1220;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      background:
        radial-gradient(1000px 700px at 70% -10%, rgba(168,85,247,.18), transparent 55%),
        radial-gradient(900px 600px at 0% 20%, rgba(59,130,246,.10), transparent 50%),
        var(--bg);
      color:var(--text);
      font-family: Inter, "Noto Sans JP", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    }

    .wrap{
      max-width:1100px;
      margin:24px auto;
      padding:0 14px 40px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:14px;
    }

    @media (max-width: 860px){
      .wrap{ grid-template-columns: 1fr; }
    }

    .header{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      margin-bottom:10px;
    }

    .title{
      font-weight:800;
      letter-spacing:.2px;
      font-size:16px;
      margin:0;
    }

    .subtitle{
      color:var(--muted);
      font-size:12px;
      margin-top:4px;
    }

    .legend{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .tag{
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      padding:8px 10px;
      border-radius:12px;
      font-size:12px;
      color:var(--muted);
      display:flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }

    .swatch{
      width:10px;height:10px;border-radius:3px;
      border:1px solid rgba(255,255,255,.20);
    }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:16px;
      overflow:hidden;
      box-shadow:0 10px 25px rgba(0,0,0,.35);
    }

    .card-h{
      padding:12px 12px 10px;
      border-bottom:1px solid rgba(255,255,255,.06);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .card-h h2{
      font-size:13px;
      margin:0;
      font-weight:800;
      letter-spacing:.2px;
    }

    .small{
      color:var(--muted);
      font-size:12px;
    }

    /* TABLE */
    .table-scroll{
      overflow:auto;
      -webkit-overflow-scrolling:touch;
    }

    table{
      width:100%;
      min-width:820px;
      border-collapse:collapse;
    }

    thead th{
      position:sticky;
      top:0;
      z-index:1;
      background:rgba(17,24,39,.92);
      backdrop-filter:blur(6px);
      text-align:left;
      font-size:12px;
      color:var(--muted);
      font-weight:800;
      padding:12px 12px;
      border-bottom:1px solid var(--line);
      white-space:nowrap;
    }

    tbody td{
      padding:12px 12px;
      border-bottom:1px solid rgba(255,255,255,.06);
      font-size:13px;
      white-space:nowrap;
      font-variant-numeric: tabular-nums;
    }

    tbody tr:hover{
      background:rgba(255,255,255,.03);
    }

    /* ZONE LEFT LINE */
    tbody tr{ position:relative; }
    tbody tr[data-zone]::before{
      content:"";
      position:absolute;
      left:0; top:0; bottom:0;
      width:4px;
    }
    tbody tr[data-zone="champ"]::before{ background:var(--gold); }
    tbody tr[data-zone="playoff"]::before{ background:var(--orange); }
    tbody tr[data-zone="releg"]::before{ background:var(--red); }

    .rank{ width:54px; color:var(--muted); }
    .team{ display:flex; align-items:center; gap:10px; min-width:240px; }
    img.crest{
      width:24px;height:24px;border-radius:50%;
      object-fit:cover;background:#fff;
      border:1px solid rgba(255,255,255,.12);
      flex-shrink:0; display:block;
    }
    .team-name{ font-weight:800; letter-spacing:.2px; }

    .nums{ text-align:right; }
    .points{ font-weight:900; text-align:right; color:#fff; }

    .zone{ color:var(--muted); font-size:12px; }
    .zone strong{ color:var(--text); font-weight:900; }

    /* RIGHT PANEL */
    .panel{
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .formgrid{
      display:grid;
      grid-template-columns: 1fr 64px 64px 1fr;
      gap:8px;
      align-items:center;
    }
    @media (max-width: 420px){
      .formgrid{ grid-template-columns: 1fr 58px 58px 1fr; }
    }

    select, input{
      width:100%;
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);
      border-radius:12px;
      padding:10px 10px;
      color:var(--text);
      font-size:13px;
      outline:none;
    }
    input[type="number"]{
      text-align:center;
      font-variant-numeric: tabular-nums;
    }
    label{
      display:block;
      color:var(--muted);
      font-size:12px;
      margin:0 0 6px;
    }

    .btnrow{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    button{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      font-weight:800;
      letter-spacing:.2px;
      cursor:pointer;
    }
    button.primary{
      background:linear-gradient(180deg, rgba(250,204,21,.20), rgba(250,204,21,.08));
      border-color:rgba(250,204,21,.35);
    }
    button.danger{
      background:linear-gradient(180deg, rgba(239,68,68,.18), rgba(239,68,68,.08));
      border-color:rgba(239,68,68,.35);
    }
    button:active{ transform:translateY(1px); }

    .list{
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .item{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.03);
      border-radius:12px;
      padding:10px 10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      font-size:13px;
    }
    .item small{ color:var(--muted); display:block; font-size:12px; margin-top:2px; }
    .mono{ font-variant-numeric: tabular-nums; }

    .hint{
      color:var(--muted);
      font-size:12px;
      line-height:1.5;
    }
    code{
      background:rgba(255,255,255,.06);
      padding:2px 6px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.08);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <!-- LEFT: TABLE -->
    <div>
      <div class="header">
        <div>
          <h1 class="title">Div.1 ãƒªãƒ¼ã‚°é †ä½è¡¨</h1>
          <div class="subtitle">çµæœå…¥åŠ› â†’ è‡ªå‹•æ›´æ–° / ã‚¹ãƒãƒ›å¯¾å¿œï¼ˆæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰</div>
        </div>

        <div class="legend">
          <div class="tag"><span class="swatch" style="background:var(--gold)"></span> 1ä½ï¼šå„ªå‹ ğŸŸ¨</div>
          <div class="tag"><span class="swatch" style="background:var(--orange)"></span> 8ä½ï¼šå…¥ã‚Œæ›¿ãˆæˆ¦ ğŸŸ§</div>
          <div class="tag"><span class="swatch" style="background:var(--red)"></span> 9-10ä½ï¼šé™æ ¼ ğŸŸ¥</div>
        </div>
      </div>

      <div class="card">
        <div class="card-h">
          <h2>é †ä½è¡¨</h2>
          <div class="small"><span id="matchCount">0</span> è©¦åˆå…¥åŠ›æ¸ˆã¿</div>
        </div>

        <div class="table-scroll">
          <table aria-label="league table">
            <thead>
              <tr>
                <th class="rank">é †ä½</th>
                <th>ãƒãƒ¼ãƒ </th>
                <th class="nums">è©¦</th>
                <th class="nums">å‹</th>
                <th class="nums">åˆ†</th>
                <th class="nums">è² </th>
                <th class="nums">å¾—</th>
                <th class="nums">å¤±</th>
                <th class="nums">å·®</th>
                <th class="points">å‹ç‚¹</th>
                <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
              </tr>
            </thead>
            <tbody id="tableBody">
              <!-- JSã§æç”» -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- RIGHT: INPUT -->
    <div class="card">
      <div class="card-h">
        <h2>çµæœå…¥åŠ›</h2>
        <div class="small">è¿½åŠ ã™ã‚‹ã¨å³åæ˜ </div>
      </div>

      <div class="panel">
        <div>
          <label>ãƒ›ãƒ¼ãƒ </label>
          <select id="homeTeam"></select>
        </div>

        <div class="formgrid">
          <div>
            <label>Home</label>
            <input id="homeGoals" type="number" inputmode="numeric" min="0" max="99" value="0">
          </div>

          <div>
            <label>â€”</label>
            <input id="awayGoals" type="number" inputmode="numeric" min="0" max="99" value="0">
          </div>

          <div>
            <label>ã‚¢ã‚¦ã‚§ã‚¤</label>
            <select id="awayTeam"></select>
          </div>
        </div>

        <div class="btnrow">
          <button class="primary" id="addMatch">è©¦åˆã‚’è¿½åŠ </button>
          <button id="resetSeason">å…¨ãƒªã‚»ãƒƒãƒˆ</button>
          <button class="danger" id="undoLast">ç›´è¿‘ã‚’å‰Šé™¤</button>
        </div>

        <div class="hint">
          ç”»åƒã¯ <code>assets/crests/ã€‡ã€‡.png</code> ã‚’ä½¿ç”¨ã€‚<br>
          ä¾‹ï¼š<code>assets/crests/freesia.png</code><br>
          â€» ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆå¤§æ–‡å­—å°æ–‡å­—/æ‹¡å¼µå­ï¼‰ãŒé•ã†ã¨è¡¨ç¤ºã•ã‚Œãªã„ã€‚
        </div>

        <div>
          <div class="card-h" style="padding:0;border:none; margin-top:8px;">
            <h2 style="margin:0;font-size:13px;">å…¥åŠ›æ¸ˆã¿è©¦åˆ</h2>
            <div class="small">ç›´è¿‘10ä»¶è¡¨ç¤º</div>
          </div>
          <div class="list" id="matchList"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ============================
    // 1) ãƒãƒ¼ãƒ å®šç¾©ï¼ˆè¡¨ç¤ºåã¨ãƒ­ã‚´ï¼‰
    // ============================
    const teams = [
      { id:"FREESIA", name:"FREESIA", crest:"assets/crests/freesia.png" },
      { id:"NAKAYOSHIKOYOSHI", name:"NAKAYOSHIKOYOSHI", crest:"assets/crests/nakayoshi.png" },
      { id:"WIZARD", name:"WIZARD", crest:"assets/crests/wizard.png" },
      { id:"PIMAN TRIBE", name:"PIMAN TRIBE", crest:"assets/crests/piman.png" },
      { id:"GUROU", name:"GUROU", crest:"assets/crests/gurou.png" },
      { id:"NEXUS", name:"NEXUS", crest:"assets/crests/nexus.png" },
      { id:"TAKI", name:"TAKI", crest:"assets/crests/taki.png" },
      { id:"MIRU KING", name:"MIRU KING", crest:"assets/crests/miru-king.png" },
      { id:"KAGURA", name:"KAGURA", crest:"assets/crests/kagura.png" },
      { id:"LETHAL", name:"LETHAL", crest:"assets/crests/lethal.png" },
    ];

    // ============================
    // 2) çŠ¶æ…‹ï¼ˆè©¦åˆä¸€è¦§ï¼‰
    // ============================
    // {homeId, awayId, hg, ag, ts}
    let matches = [];

    // localStorageã§ä¿å­˜ï¼ˆãƒšãƒ¼ã‚¸æ›´æ–°ã—ã¦ã‚‚æ®‹ã‚‹ï¼‰
    const LS_KEY = "div1_matches_v1";

    function load(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(raw){
          const parsed = JSON.parse(raw);
          if(Array.isArray(parsed)) matches = parsed;
        }
      }catch(e){}
    }
    function save(){
      try{ localStorage.setItem(LS_KEY, JSON.stringify(matches)); }catch(e){}
    }

    // ============================
    // 3) é›†è¨ˆ
    // ============================
    function emptyStats(team){
      return {
        id: team.id,
        name: team.name,
        crest: team.crest,
        p:0,w:0,d:0,l:0,gf:0,ga:0,gd:0,pts:0
      };
    }

    function computeTable(){
      const map = new Map(teams.map(t => [t.id, emptyStats(t)]));

      for(const m of matches){
        const home = map.get(m.homeId);
        const away = map.get(m.awayId);
        if(!home || !away) continue;

        home.p++; away.p++;
        home.gf += m.hg; home.ga += m.ag;
        away.gf += m.ag; away.ga += m.hg;

        if(m.hg > m.ag){
          home.w++; home.pts += 3;
          away.l++;
        }else if(m.hg < m.ag){
          away.w++; away.pts += 3;
          home.l++;
        }else{
          home.d++; away.d++;
          home.pts += 1; away.pts += 1;
        }
      }

      // GDæ›´æ–°
      for(const s of map.values()){
        s.gd = s.gf - s.ga;
      }

      // ã‚½ãƒ¼ãƒˆï¼šå‹ç‚¹ â†’ å¾—å¤±ç‚¹å·® â†’ å¾—ç‚¹ â†’ åå‰
      const arr = Array.from(map.values());
      arr.sort((a,b)=>{
        if(b.pts !== a.pts) return b.pts - a.pts;
        if(b.gd !== a.gd) return b.gd - a.gd;
        if(b.gf !== a.gf) return b.gf - a.gf;
        return a.name.localeCompare(b.name, "en");
      });

      return arr;
    }

    // ============================
    // 4) ã‚¾ãƒ¼ãƒ³åˆ¤å®šï¼ˆé †ä½ã«å¿œã˜ã¦è‰²ï¼‰
    // 1ä½: champ, 8ä½: playoff, 9-10ä½: releg
    // ============================
    function zoneForRank(rank){
      if(rank === 1) return { key:"champ", label:"å„ªå‹ ğŸŸ¨" };
      if(rank === 8) return { key:"playoff", label:"å…¥ã‚Œæ›¿ãˆæˆ¦ ğŸŸ§" };
      if(rank === 9 || rank === 10) return { key:"releg", label:"é™æ ¼ ğŸŸ¥" };
      return { key:"", label:"-" };
    }

    // ============================
    // 5) æç”»
    // ============================
    const tableBody = document.getElementById("tableBody");
    const matchList = document.getElementById("matchList");
    const matchCount = document.getElementById("matchCount");

    function render(){
      const rows = computeTable();

      // ãƒ†ãƒ¼ãƒ–ãƒ«
      tableBody.innerHTML = "";
      rows.forEach((r, idx)=>{
        const rank = idx + 1;
        const z = zoneForRank(rank);

        const tr = document.createElement("tr");
        if(z.key) tr.setAttribute("data-zone", z.key);

        tr.innerHTML = `
          <td class="rank">${rank}</td>
          <td>
            <div class="team">
              <img class="crest" src="${r.crest}" alt="${escapeHtml(r.name)}">
              <span class="team-name">${escapeHtml(r.name)}</span>
            </div>
          </td>
          <td class="nums">${r.p}</td>
          <td class="nums">${r.w}</td>
          <td class="nums">${r.d}</td>
          <td class="nums">${r.l}</td>
          <td class="nums">${r.gf}</td>
          <td class="nums">${r.ga}</td>
          <td class="nums">${formatGd(r.gd)}</td>
          <td class="points">${r.pts}</td>
          <td class="zone">${z.key ? `<strong>${z.label}</strong>` : `-`}</td>
        `;
        tableBody.appendChild(tr);
      });

      // è©¦åˆãƒªã‚¹ãƒˆï¼ˆç›´è¿‘10ä»¶ï¼‰
      matchCount.textContent = matches.length.toString();
      matchList.innerHTML = "";
      const recent = matches.slice().reverse().slice(0, 10);
      if(recent.length === 0){
        matchList.innerHTML = `<div class="hint">ã¾ã è©¦åˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚å³ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰è¿½åŠ ã—ã¦ã­ã€‚</div>`;
      }else{
        for(const m of recent){
          const home = teams.find(t=>t.id===m.homeId)?.name ?? m.homeId;
          const away = teams.find(t=>t.id===m.awayId)?.name ?? m.awayId;
          const when = new Date(m.ts || Date.now());
          const stamp = `${when.getFullYear()}/${pad2(when.getMonth()+1)}/${pad2(when.getDate())} ${pad2(when.getHours())}:${pad2(when.getMinutes())}`;

          const div = document.createElement("div");
          div.className = "item";
          div.innerHTML = `
            <div>
              <div>${escapeHtml(home)} <span class="mono">${m.hg} - ${m.ag}</span> ${escapeHtml(away)}</div>
              <small>${stamp}</small>
            </div>
            <div class="small">+åæ˜ æ¸ˆ</div>
          `;
          matchList.appendChild(div);
        }
      }
    }

    function formatGd(gd){
      return gd > 0 ? `+${gd}` : `${gd}`;
    }
    function pad2(n){ return String(n).padStart(2,"0"); }
    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#39;");
    }

    // ============================
    // 6) å…¥åŠ›UI
    // ============================
    const homeTeam = document.getElementById("homeTeam");
    const awayTeam = document.getElementById("awayTeam");
    const homeGoals = document.getElementById("homeGoals");
    const awayGoals = document.getElementById("awayGoals");

    function fillSelects(){
      const opts = teams.map(t => `<option value="${escapeHtml(t.id)}">${escapeHtml(t.name)}</option>`).join("");
      homeTeam.innerHTML = opts;
      awayTeam.innerHTML = opts;

      // åˆæœŸã§è¢«ã‚‰ãªã„ã‚ˆã†ã«
      homeTeam.value = teams[0].id;
      awayTeam.value = teams[1].id;
    }

    document.getElementById("addMatch").addEventListener("click", ()=>{
      const h = homeTeam.value;
      const a = awayTeam.value;

      if(h === a){
        alert("ãƒ›ãƒ¼ãƒ ã¨ã‚¢ã‚¦ã‚§ã‚¤ã¯åˆ¥ãƒãƒ¼ãƒ ã«ã—ã¦ã­ã€‚");
        return;
      }

      const hg = clampInt(homeGoals.value, 0, 99);
      const ag = clampInt(awayGoals.value, 0, 99);

      matches.push({ homeId:h, awayId:a, hg, ag, ts: Date.now() });
      save();
      render();
    });

    document.getElementById("undoLast").addEventListener("click", ()=>{
      if(matches.length === 0){
        alert("å‰Šé™¤ã§ãã‚‹è©¦åˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
        return;
      }
      matches.pop();
      save();
      render();
    });

    document.getElementById("resetSeason").addEventListener("click", ()=>{
      const ok = confirm("å…¨è©¦åˆã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ");
      if(!ok) return;
      matches = [];
      save();
      render();
    });

    function clampInt(v, min, max){
      const n = Number.parseInt(v, 10);
      if(Number.isNaN(n)) return min;
      return Math.max(min, Math.min(max, n));
    }

    // åˆæœŸåŒ–
    load();
    fillSelects();
    render();
  </script>
</body>
</html>
